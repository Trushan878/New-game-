<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Multiplayer Game Scoreboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h2 class="text-2xl font-semibold text-center mb-6">Game Scoreboard</h2>

    <!-- Leaderboard -->
    <div id="leaderboard" class="bg-purple-100 p-3 rounded mb-4 text-sm max-h-40 overflow-auto">
      <h3 class="font-bold text-lg mb-2 text-purple-700">Leaderboard</h3>
      <div id="leaderboardContent"></div>
    </div>

    <div class="mb-4">
      <input id="playerName" type="text" placeholder="Enter player name" class="border border-gray-300 rounded px-4 py-2 w-full"/>
      <button id="addPlayer" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Add Player</button>
    </div>

    <div id="playersList" class="space-y-2 mb-6"></div>

    <div class="mb-4">
      <input id="pointsToAdd" type="number" placeholder="Enter points to add" class="border border-gray-300 rounded px-4 py-2 w-full"/>
      <button id="addPoints" class="mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">Add Points to Selected</button>
    </div>

    <div class="mb-4">
      <button id="resetPoints" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 w-full">Reset All Points</button>
    </div>

    <div class="mb-4">
      <button id="whatsappBtn" class="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800 w-full">Send to WhatsApp</button>
    </div>

    <div class="bg-gray-100 p-4 rounded">
      <h3 class="text-lg font-bold mb-2">Game History</h3>
      <div id="pointsHistory" class="text-sm space-y-1"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const playersRef = db.ref('players');

    const playerNameInput = document.getElementById('playerName');
    const addPlayerBtn = document.getElementById('addPlayer');
    const playersList = document.getElementById('playersList');
    const pointsToAddInput = document.getElementById('pointsToAdd');
    const addPointsBtn = document.getElementById('addPoints');
    const resetPointsBtn = document.getElementById('resetPoints');
    const pointsHistory = document.getElementById('pointsHistory');

    addPlayerBtn.onclick = () => {
      const name = playerNameInput.value.trim();
      if (name) {
        playersRef.child(name).set({ points: 0 });
        playerNameInput.value = '';
      }
    };

    addPointsBtn.onclick = async () => {
      const points = parseInt(pointsToAddInput.value);
      if (!isNaN(points)) {
        const checkboxes = document.querySelectorAll('#playersList input[type=checkbox]:checked');
        for (const box of checkboxes) {
          const player = box.value;
          const ref = playersRef.child(player).child('points');
          const snap = await ref.once('value');
          const current = snap.val() || 0;
          ref.set(current + points);
        }
        pointsToAddInput.value = '';
      }
    };

    resetPointsBtn.onclick = async () => {
      const snap = await playersRef.once('value');
      const data = snap.val() || {};
      for (const name in data) {
        playersRef.child(name).child('points').set(0);
      }
    };

    playersRef.on('value', snap => {
      const data = snap.val() || {};
      playersList.innerHTML = '';
      pointsHistory.innerHTML = '';
      const leaderboardContent = document.getElementById('leaderboardContent');
      leaderboardContent.innerHTML = '';

      const sortedPlayers = Object.entries(data).sort((a, b) => b[1].points - a[1].points);
      sortedPlayers.slice(0, 3).forEach(([name, val], index) => {
        const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
        const entry = document.createElement('div');
        entry.textContent = `${medals[index] || ''} ${name} â€” ${val.points} points`;
        leaderboardContent.appendChild(entry);
      });

      for (const name in data) {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between';
        div.innerHTML = `
          <label class="flex items-center gap-2">
            <input type="checkbox" value="${name}" class="w-5 h-5" />
            <span class="text-lg">${name}</span>
          </label>
          <span class="text-sm text-gray-600">Points: ${data[name].points}</span>
          <button class="removePlayerBtn bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600" data-player="${name}">Remove</button>
        `;
        playersList.appendChild(div);
      }

      document.querySelectorAll('.removePlayerBtn').forEach(btn => {
        btn.onclick = () => {
          const playerToRemove = btn.getAttribute('data-player');
          playersRef.child(playerToRemove).remove();
        };
      });

      for (const name in data) {
        const historyEntry = document.createElement('div');
        historyEntry.textContent = `${name}: ${data[name].points} points`;
        pointsHistory.appendChild(historyEntry);
      }
    });

    document.getElementById('whatsappBtn').onclick = async () => {
      const snap = await playersRef.once('value');
      const data = snap.val() || {};
      let message = `*Game Scoreboard* - ${new Date().toLocaleString()}\n\n`;

      for (const name in data) {
        message += `*${name}* â€” ${data[name].points} point(s)\n`;
      }

      const sorted = Object.entries(data).sort((a, b) => b[1].points - a[1].points);
      message += `\n------------------\n*Winners*\n`;
      sorted.slice(0, 3).forEach(([name, val], i) => {
        const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
        message += `${medals[i] || 'âœ…'} *${name}*: ${val.points} pts\n`;
      });

      const encoded = encodeURIComponent(message);
      window.open(`https://wa.me/?text=${encoded}`, '_blank');
    };
  </script>
</body>
</html>
