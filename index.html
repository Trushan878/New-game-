<!DOCTYPE html>
<html>
<head>
  <title>Scoreboard with Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    .player { margin-bottom: 10px; }
  </style>
</head>
<body>

<h2>Scoreboard</h2>

<div id="playersContainer"></div>

<button id="submitBtn">Submit All Changes</button>

<script>
  // --- Your Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyD6QJcL3I3yHApVn0DcMfJWgHLwOREB5VU",
    authDomain: "point-system-1bd8a.firebaseapp.com",
    databaseURL: "https://point-system-1bd8a-default-rtdb.firebaseio.com/",
    projectId: "point-system-1bd8a",
    storageBucket: "point-system-1bd8a.appspot.com",
    messagingSenderId: "755307639843",
    appId: "1:755307639843:web:6d5393d99cbe70a7c0ed96",
    measurementId: "G-9ZMSNWJHHH"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const playersRef = db.ref('players');

  const playersContainer = document.getElementById('playersContainer');
  const submitBtn = document.getElementById('submitBtn');

  let playersData = {};

  // Render players with controls
  function renderPlayers(players) {
    playersContainer.innerHTML = '';
    playersData = players;

    for (const playerName in players) {
      const player = players[playerName];
      const div = document.createElement('div');
      div.classList.add('player');
      div.dataset.name = playerName;

      div.innerHTML = `
        <strong>${playerName}</strong> - Current points: <span class="points">${player.points}</span><br>
        <label>
          <input type="radio" name="op_${playerName}" value="plus" checked> +
        </label>
        <label>
          <input type="radio" name="op_${playerName}" value="minus"> -
        </label>
        <input type="number" class="pointsInput" value="0" min="0" style="width: 60px;">
      `;

      playersContainer.appendChild(div);
    }
  }

  // Listen for players data changes in Firebase
  playersRef.on('value', snapshot => {
    const players = snapshot.val() || {};
    renderPlayers(players);
  });

  // When submit clicked: update all players points based on inputs and plus/minus selection
  submitBtn.onclick = () => {
    const updates = {};
    const playerDivs = playersContainer.querySelectorAll('.player');

    playerDivs.forEach(div => {
      const playerName = div.dataset.name;
      const currentPoints = playersData[playerName]?.points || 0;

      const op = div.querySelector(`input[name="op_${playerName}"]:checked`).value;
      const input = div.querySelector('.pointsInput');
      let change = parseInt(input.value) || 0;

      // Apply plus or minus
      if (op === 'minus') {
        change = -change;
      }

      let newPoints = currentPoints + change;
      if (newPoints < 0) newPoints = 0; // Avoid negative points

      updates[playerName + '/points'] = newPoints;
    });

    // Push update to Firebase
    playersRef.update(updates).then(() => {
      alert('Points updated successfully!');
    }).catch(error => {
      alert('Error updating points: ' + error.message);
    });
  };
</script>

</body>
</html>
